<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Event Finder Results</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/event_finder_results.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/calendarMODS.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/heading.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/notification.css') }}">

  <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
  <script src="{{ url_for('static', filename='js/event_finder_results.js') }}"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script src="{{ url_for('static', filename='js/navbar_user.js') }}" defer></script>
  <script src="https://maps.googleapis.com/maps/api/js?key={{ maps_api_key }}&libraries=places" async defer></script>
</head>
<body>
  <script>
    //get calendar type, personal or group    
    function getCalendarTypeFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get('type');
    }
    let type = getCalendarTypeFromUrl();
    if (type) {
      window.selectedCalendarType = type;
      localStorage.setItem('selectedCalendarType', type);
    } else if (localStorage.getItem('selectedCalendarType')) {
      window.selectedCalendarType = localStorage.getItem('selectedCalendarType');
    } else {
      window.selectedCalendarType = 'personal';
    }
  </script>
  {% include '_navbar.html' %}
  <div style="margin-top:2rem;">
    <button onclick="window.history.back()" class="btn">&larr; Back</button>
  </div>
  <h2 class="page-heading" style="margin-top:2rem;">Top Results</h2>
  <div class="container">
    <div class="results">
      <ul id="results-list" style="list-style:none; padding-left:0; margin:0;">
        {% if results %}
          {% for place in results %}
            <li class="result-item" data-index="{{ loop.index0 }}">
              <strong>{{ place.name }}</strong><br>
              <span class="rating">Rating: {{ place.rating or 'N/A' }}</span><br>
              <span>{{ place.formatted_address or place.vicinity or '' }}</span>
            </li>
          {% endfor %}
        {% else %}
          <li>No results found.</li>
        {% endif %}
      </ul>
    </div>

    <div id="map" class="map"></div>
  </div>

  <!-- Modal for place details -->
  <div id="placeModal" class="modal-bg">
    <div class="modal-content">
      <span id="modalClose" class="modal-close">&times;</span>
      <div id="modalContent"></div>
    </div>
  </div>

  <script>
    window.eventFinderResults = JSON.parse('{{ results | tojson | safe }}');
    window.mapsApiKey = '{{ maps_api_key }}';
    window.onload = function() {
      if (window.initMap) window.initMap();
    };
  </script>

</body>
</html>
